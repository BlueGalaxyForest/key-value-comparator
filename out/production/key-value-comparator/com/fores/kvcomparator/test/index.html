<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<!--867 915-->
<script>
    //添加其他合同
    CaseShow.on('click', '.c_t_htxx_Main_add', function () {
        if (!Add) {
            layer.msg('请先填写主合同的合同编号');
            return;
        }
        admin.popup({
            title: '选择合同类型',
            id: 'SelContract',
            btn: ['提交', '取消'],
            btnAlign: 'c',
            area: ['400px', '280px'],
            content: '<div class="layui-form layui-form-pane" lay-filter="sct"><label class="layui-form-label">合同类型</label><div class="layui-input-inline"><select id="selectContractType"></select></div></div>',
            success: function (layero, index) {
                admin.req({
                    url: 'api/SunOA/Case/GetAllowedAdd?CTID=' + MainCTID + '&CaseId=' + CaseId,
                    success: function (res) {
                        layui.each(res.data, function (i, o) {
                            $("#selectContractType").append('<option value="' + o.CTID + '">' + o.CTName + '</option>');
                            form.render('select', 'sct');
                        });
                    }
                });
            }, yes: function (indexs) {
                var CTID = $("#selectContractType").val();
                var ctname = $("#selectContractType").find('option[value="' + CTID + '"]').text();
                layer.close(indexs);
                var dtds = $.Deferred();
                admin.popup({
                    title: '添加' + ctname
                    , id: 'soa-cc-OtherContract'
                    , btn: ['提交', '取消']
                    , btnAlign: 'c'
                    , area: [ShowWidth, ShowHeight]
                    , shade: 0
                    , maxmin: true
                    , success: function (layero, index) {
                        view(this.id).render('/case/Contract/OtherContract', { index: index, CaseId: CaseId, CBID: CBID, CTID: CTID, dtds: dtds, SNID: 0, MainContractNo: MainContractNo });
                    }, yes: function (index) {
                        $("#Other_form-submit").trigger("click");
                        $.when(dtds)
                            .done(function () {
                                //刷新侧边选择
                                RefreshSidebar();
                            });
                    }
                });
            }
        });
    });
</script>
</html>